name: ğŸï¸ Image to NES ROM Converter

on:
  push:
    paths:
      # ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç”»åƒãŒãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸã‚‰èµ·å‹•
      - 'images/**.png'
      - 'images/**.jpg'
      - 'images/**.jpeg'

jobs:
  build-nes-rom:
    runs-on: ubuntu-latest

    steps:
      # 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - name: Check out repository
        uses: actions/checkout@v4

      # 2. Python ç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      - name: Set up Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (requirements.txt ã‚’å‚ç…§)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4. å¤‰æ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ
      - name: Run NES conversion script
        run: |
          # å‡ºåŠ›ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
          mkdir -p nes_roms

          # images/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®å…¨ã¦ã® .png ã¨ .jpg ã‚’å‡¦ç†
          for img_file in images/*.png images/*.jpg images/*.jpeg; do
            if [ -f "$img_file" ]; then
              # ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰æ‹¡å¼µå­ã‚’é™¤ã„ãŸåå‰ã‚’å–å¾— (ä¾‹: images/castle.png -> castle)
              filename=$(basename "$img_file")
              base_name="${filename%.*}"
              
              echo "Processing $img_file -> nes_roms/$base_name.nes"
              
              # ã“ã“ã§ã€Python ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
              python tools/image_to_nes.py "$img_file" "nes_roms/$base_name.nes"
            fi
          done

      # 5. ç”Ÿæˆã•ã‚ŒãŸ .nes ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€Œã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã€ã¨ã—ã¦ä¿å­˜
      - name: Upload .nes ROMs as Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: nes-roms
          path: nes_roms/ # nes_roms ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå…¨ä½“ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
