name: Build NES ROM

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  build:
    name: Build ROM
    runs-on: ubuntu-latest # Linux環境で実行

    steps:
      # 1. リポジトリのコードをチェックアウト
      - name: Check out repository
        uses: actions/checkout@v4

      # 2. cc65 (NES開発ツールチェーン) をインストール
      - name: Install cc65
        run: |
          sudo apt-get update
          sudo apt-get install -y cc65

      # 3. アセンブル (アセンブリコードをオブジェクトファイルに)
      - name: Assemble source files
        working-directory: ./src
        run: |
          ca65 header.s -o ../header.o
          ca65 main.s -o ../main.o

      # 4. リンク (オブジェクトファイルをROMに)
      - name: Link object files
        run: |
          ld65 -C src/nes.cfg -o rapid-fire-counter.nes header.o main.o

      # 5. 成果物 (ROM) をアップロード
      - name: Upload ROM artifact
        uses: actions/upload-artifact@v4
        with:
          name: nes-rom # アーティファクト名
          path: rapid-fire-counter.nes # アップロードするファイル
